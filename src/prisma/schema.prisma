// Prisma Schema for Calorie Tracker Application
// Database: PostgreSQL (hosted on Neon)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - stores authentication and profile data
model User {
  id               String   @id @default(uuid())
  email            String   @unique
  password         String
  name             String?
  age              Int?
  weight           Float?   // in kg
  height           Float?   // in cm
  gender           String?  // 'male' or 'female'
  activityLevel    Float?   // 1.2, 1.375, 1.55, 1.725, 1.9
  bmi              Float?
  dailyCalorieGoal Int?
  isOnboarded      Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  meals          Meal[]
  dailySummaries DailySummary[]

  @@index([email])
}

// Meal model - stores individual meal entries
model Meal {
  id            String   @id @default(uuid())
  userId        String
  mealType      String   // breakfast, lunch, dinner, snack
  description   String?
  imageUrl      String?
  totalCalories Int
  protein       Float?   // in grams
  carbs         Float?   // in grams
  fats          Float?   // in grams
  fiber         Float?   // in grams
  mealDate      DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodItems FoodItem[]

  @@index([userId])
  @@index([mealDate])
  @@index([userId, mealDate])
}

// FoodItem model - individual food items within a meal
model FoodItem {
  id        String   @id @default(uuid())
  mealId    String
  foodName  String
  quantity  Float
  unit      String   // grams, ml, pieces
  calories  Int
  protein   Float?
  carbs     Float?
  fats      Float?
  createdAt DateTime @default(now())

  // Relations
  meal Meal @relation(fields: [mealId], references: [id], onDelete: Cascade)

  @@index([mealId])
}

// DailySummary model - aggregated daily nutrition data
model DailySummary {
  id            String   @id @default(uuid())
  userId        String
  date          DateTime
  totalCalories Int
  totalProtein  Float
  totalCarbs    Float
  totalFats     Float
  calorieGoal   Int
  mealsCount    Int
  createdAt     DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
  @@index([userId])
  @@index([date])
}
